<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    >

		<title>Modelling the Cosmos in Ruby</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="custom.css">
		<link rel="stylesheet" href="plugin/highlight/obsidian.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Prosto+One&display=swap">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
        <section>
          <h1 style="margin: 0">
            Modelling the Cosmos in Ruby
          </h1>
        </section>
        <section>
          <h2>The sky is a lie</h2>
        </section>
        <section>
          <p>We see what's in the past</p>
        </section>
        <section>
          <p>Sunrise and sunset times are fake</p>
        </section>
        <section>
          <p>The Pole Star is not at the celestial pole</p>
        </section>
        <section>
          <p>A day is not 24 hours</p>
        </section>
        <section>
          <p>Build an accurate astronomy library with that</p>
          <p>
            <img src="img/cringe.png" style="width: 300px" alt="Cringe meme">
          </p>
        </section>
        <section>
          <h2>Hi, I'm R√©my</h2>
          <br>
          <p class="slightly-smaller-text">@rhannequin</p>
        </section>
        <section>
          <p>Senior developer at thoughtbot</p>
          <br>
          <p>
            <img
              src="img/thoughtbot.svg"
              alt="thoughtbot LOGO"
              style="width: 200px; border: 0; box-shadow: none">
          </p>
        </section>
        <section>
          <p>In love with astronomy</p>
        </section>
        <section>
          <p>
            Let's meet and talk
            <br>
            ü™êüçîü§ñüíªüçø
          </p>
        </section>
        <section>
          <h2>What are we going to talk about?</h2>
        </section>
        <section>
          <p>Complex domain models</p>
        </section>
        <section>
          <p>Learn code design techniques</p>
        </section>
        <section>
          <p>Code readability for collaboration and education</p>
        </section>
        <section>
          <h2>Context: Astronoby</h2>
        </section>
        <section>
          <p>Astronomical data and events accessible in Ruby</p>
        </section>
        <section>
          <p class="shorter-text">Position of planets in the sky ü™ê</p>
          <p class="shorter-text">Rising, transit and setting times üåÑ</p>
          <p class="shorter-text">Equinoxes and solstices times ‚òÄÔ∏è</p>
          <p class="shorter-text">Moon phases üåô</p>
        </section>
        <section>
          <p>Future:</p>
          <p>Conjunctions, oppositions</p>
          <p>Eclipses</p>
          <p>Deep sky objects</p>
          <p>Stargazing planner</p>
        </section>
        <section>
          <p>Increase scientific support in the Ruby ecosystem</p>
        </section>
        <section>
          <p>
            <img src="img/qr.png" alt="QR code for Astronoby" width="400">
          </p>
          <p>
            <a href="https://tbot.io/astronoby">tbot.io/astronoby</a>
          </p>
        </section>
        <section>
          <p>Azimuth: 123¬∞44‚Ä≤47‚Ä≥</p>
          <p>Altitude: 49¬∞26‚Ä≤14‚Ä≥</p>
          <p>
            <img
              src="img/mars.png"
              alt="Mars"
              style="width: 150px; border: 0; box-shadow: none">
          </p>
          <p><img src="img/geneva.jpg" alt="Geneva" style="width: 400px"></p>
        </section>
        <section>
          <div class="row">
            <div class="col-35 smaller-text">
              <p>
                <span>Solar System Barycenter</span>
                <span><br>Vector</span>
                <span><br>Light-time</span>
                <span><br>Precession</span>
                <span><br>Nutation</span>
                <span><br>Aberration</span>
                <span><br>Deflection</span>
                <span><br>Earth shape</span>
                <span><br>Terrestrial time</span>
              </p>
              <p style="text-align: left">
                <img
                  src="img/dead-inside.jpg"
                  alt="Dead Inside meme"
                  style="width: 100px; height: 100px; border-radius: 50%; margin-top: 50px;">
              </p>
            </div>
            <div class="col-65 small-text">
              <p>Barycentric position</p>
              <p>Geocentric astrometric position</p>
              <p>Geocentric apparent position</p>
              <p>Topocentric apparent position</p>
              <p>Equatorial coordinates</p>
              <p>Horizontal coordinates</p>
            </div>
          </div>
        </section>
        <section>
          <p>
            How to deal with a large and complex domain?
          </p>
        </section>
        <section>
          <h2>Domain-Driven Design</h2>
        </section>
        <section>
          <h2>DDD? üëç</h2>
        </section>
        <section>
          <p>Introduced in 2003 by Eric Evans</p>
          <p>Reflects business domain</p>
          <p>Focus on core domain</p>
        </section>
        <section>
          <div class="row">
            <div class="col-50">
              <p>‚ùå</p>
              <p
                class="fragment visible"
                data-fragment-index="0"
                style="font-size: 1em"
              >
                <small>Technical layers</small>
              </p>
              <p
                class="fragment visible"
                data-fragment-index="2"
                style="font-size: 1em"
              >
                <small>Large exhaustive models</small>
              </p>
              <br>
              <p
                class="fragment visible"
                data-fragment-index="4"
                style="font-size: 1em"
              >
                <small>Uniform objects</small>
              </p>
            </div>
            <div class="col-50">
              <p>‚úÖ</p>
              <p
                class="fragment visible"
                data-fragment-index="1"
                style="font-size: 1em"
              >
                <small>Business concepts</small>
              </p>
              <p
                class="fragment visible"
                data-fragment-index="3"
                style="font-size: 1em"
              >
                <small>Multiple models with explicit boundaries</small>
              </p>
              <p
                class="fragment visible"
                data-fragment-index="5"
                style="font-size: 1em"
              >
                <small>Entities and value objects</small>
              </p>
            </div>
          </div>
        </section>
        <section>
          <h3>Ubiquitous Language</h3>
        </section>
        <section>
          <h3>Ubiquitous Language</h3>
          <div class="row">
            <div class="col col-50">
              <p>‚ùå</p>
              <pre><code class="language-ruby" style="font-size: 0.7em">
class MoonState
  def self.compute(state, time)
    new(
      time: time,
      state: state
    )
  end
end</code></pre>
            </div>
            <div class="col col-50">
              <p>‚úÖ</p>
              <pre><code class="language-ruby" style="font-size: 0.7em">
class MoonPhase
  def self.full_moon(time)
    new(
      time: time,
      phase: FULL_MOON
    )
  end
end</code></pre>
            </div>
          </div>
        </section>
        <section>
          <p>When DDD?</p>
          <p>Complex domain</p>
          <p>Collaboration</p>
        </section>
        <section>
          <p>Ruby ‚ù§Ô∏è DDD</p>
          <ul>
            <li>OOP</li>
            <li>Expressiveness</li>
            <li>Modules</li>
            <li>Metaprogramming</li>
          </ul>
        </section>
        <section>
          <h2>DDD in Astronoby</h2>
        </section>
        <section>
          <h3>Repositories</h3>
          <p>
            <code>Ephem</code>
          </p>
        </section>
        <section>
          <p><code>Ephem</code></p>
          <pre><code class="language-ruby">
  ephem = Astronoby::Ephem.load("de440s.bsp")

  ephem[0, 3].position_at(2460819)
  # => Vector[-71204709, -123739936, -53612310]</code></pre>
        </section>
        <section>
          <h3>Domain services</h3>
          <p><code>RiseTransitSetCalculator</code></p>
          <p><code>MoonPhases</code></p>
        </section>
        <section>
          <p><code>RiseTransitSetCalculator</code></p>
          <pre><code class="language-ruby" style="font-size: 0.8em">
calculator =
  Astronoby::RiseTransitSetCalculator.new(
    body: Astronoby::Sun,
    observer: observer,
    ephem: ephem
  )

event = calculator.event_on(date)
# => Astronoby::RiseTransitSetEvent object

event.rising_time
# => 2025-05-23 05:54:08 +0200</code></pre>
        </section>
        <section>
          <h3>Value objects</h3>
          <p><code>Angle</code></p>
          <p><code>Instant</code></p>
          <p><code>Distance</code></p>
        </section>
        <section>
          <p><code>Angle</code></p>
          <pre><code class="language-ruby">
    angle = Astronoby::Angle.from_degres(240)

    angle.hours
    # => 16.0

    angle.cos
    # => -0.5</code></pre>
        </section>
        <section>
          <h3>Entities</h3>
          <p><code>Jupiter</code></p>
          <p><code>Observer</code></p>
        </section>
        <section>
          <p><code>Jupiter</code></p>
          <pre><code class="language-ruby">
        jupiter = Astronoby::Jupiter.new(
          ephem: ephem,
          instant: instant
        )

        jupiter.apparent.distance.km
        # => 904241448</code></pre>
        </section>
        <section>
          <img
            src="img/ddd-chart.png"
            alt="DDD Chart"
            style="width: 1000px; max-width: 500%; max-height: 500%; margin: 0">
        </section>
        <section>
          <pre><code class="language-ruby" style="font-size: 0.7em; max-height: 550px;">
ephem = Astronoby::Ephem.load("inpop19a.bsp")

time = Time.utc(2025, 5, 23, 14, 30, 0)
instant = Astronoby::Instant.from_time(time)

geneva = Astronoby::Observer.new(
  latitude: Astronoby::Angle.from_degrees(46.2044),
  longitude: Astronoby::Angle.from_degrees(6.1432),
  elevation: Astronoby::Distance.from_meters(375)
)

mars = Astronoby::Mars.new(instant: instant, ephem: ephem)

topocentric = mars.observed_by(geneva)

topocentric.horizontal.altitude.degrees
# => 49.4371279134974</code></pre>
        </section>
        <section>
          <pre><code
            class="language-ruby"
            style="font-size: 0.7em; max-height: 550px;"
            data-line-numbers="2|4-5|7-11|13|15|17-18">
ephem = Astronoby::Ephem.load("inpop19a.bsp")

time = Time.utc(2025, 5, 23, 14, 30, 0)
instant = Astronoby::Instant.from_time(time)

geneva = Astronoby::Observer.new(
  latitude: Astronoby::Angle.from_degrees(46.2044),
  longitude: Astronoby::Angle.from_degrees(6.1432),
  elevation: Astronoby::Distance.from_meters(375)
)

sun = Astronoby::Sun.new(instant: instant, ephem: ephem)

topocentric = sun.observed_by(geneva)

topocentric.horizontal.altitude.degrees
# => 49.4371279134974</code></pre>
        </section>
        <section>
          <pre><code class="language-ruby" style="font-size: 0.7em; max-height: 550px;">
ephem = Astronoby::Ephem.load("inpop19a.bsp")

time = Time.utc(2025, 5, 23, 14, 30, 0)
instant = Astronoby::Instant.from_time(time)

geneva = Astronoby::Observer.new(
  latitude: Astronoby::Angle.from_degrees(46.2044),
  longitude: Astronoby::Angle.from_degrees(6.1432),
  elevation: Astronoby::Distance.from_meters(375)
)

mars = Astronoby::Mars.new(instant: instant, ephem: ephem)

topocentric = mars.observed_by(geneva)

topocentric.horizontal.altitude.degrees
# => 49.4371279134974</code></pre>
        </section>
        <section>
          <h2>Value objects</h2>
        </section>
        <section>
          <p>Replace primitives</p>
          <p>Encapsulate data</p>
          <p>No or little behaviour</p>
        </section>
        <section>
          <p><code>Time</code></p>
          <pre><code class="language-ruby">
                time = Time.now

                time.hour
                # => 16

                time.to_i
                # => 1747917900</code></pre>
        </section>
        <section>
          <pre><code class="language-ruby">
    distance1 = Distance.from_meters(1000)
    distance2 = Distance.from_kilometers(1)

    distance1 == distance2
    # => true

    distance3 = distance1 + distance2

    distance3.to_meters
    # => 2000</code></pre>
        </section>
        <section>
          <p>
            <code>Comparable</code>&nbsp;&nbsp;&nbsp;<code>#<=></code>
          </p>
          <br>
          <p>
            <code>Data</code>
          </p>
        </section>
        <section>
          <p><code>Without value object</code></p>
          <pre><code class="language-ruby" style="font-size: 0.7em">
declination_radians = declination_degrees * Math::PI / 180
latitude_radians = latitude_degrees * Math::PI / 180
hour_angle_radians = hour_angle_hours * 15 * Math::PI / 180

ratio = Math.sin(declination_radians) *
        Math.sin(latitude_radians) +
        Math.cos(declination_radians) *
        Math.cos(latitude_radians) *
        Math.cos(hour_angle_radians)

altitude_radians = Math.asin(ratio)</code></pre>
        </section>
        <section>
          <p><code>Astronoby::Angle</code></p>
          <pre><code class="language-ruby" style="font-size: 0.8em">
ratio = declination.sin * latitude.sin +
        declination.cos * latitude.cos * hour_angle.cos

altitude = Astronoby::Angle.asin(ratio)</code></pre>
          <p>
            <img
              src="img/wow.gif"
              alt="Rainbow drool meme"
              style="width: 75px">
          </p>
        </section>
        <section>
          <h2>Testing</h2>
        </section>
        <section>
          <h3>DDD ‚ù§Ô∏è Testing</h3>
          <p>Well-defined objects</p>
          <p>Bounded contexts</p>
        </section>
        <section>
          <h3>Pragmatism</h3>
          <p class="small-text">Source of truth: IMCCE, NASA/JPL</p>
          <p>
            <img src="img/imcce.png" alt="IMCCE" style="width: 700px">
          </p>
        </section>
        <section>
          <p>Unit tests</p>
          <p class="slightly-smaller-text">‚¨áÔ∏è</p>
          <p>Integration tests</p>
          <p class="slightly-smaller-text">‚¨áÔ∏è</p>
          <p>Scientific validation</p>
        </section>
        <section>
          <h2>Beyond astronomy</h2>
        </section>
        <section>
          <h3>Identify</h3>
          <p>Talk to the stakeholders</p>
          <p>Document the vocabulary</p>
        </section>
        <section>
          <h3>Map the boundaries</h3>
          <p>Create bounded contexts</p>
          <p>Add clear interfaces</p>
        </section>
        <section>
          <h3>Value objects</h3>
          <p>Primitive obsession</p>
          <p>Find literals</p>
        </section>
        <section>
          <h3>Separate responsibilities</h3>
          <p>Split the logic</p>
          <p><em>"Tell, Don't Ask"</em></p>
        </section>
        <section>
          <h3>Don't overthink</h3>
          <p>Prioritize</p>
          <p>Stay flexible</p>
        </section>
        <section>
          <h2>Conclusion</h2>
        </section>
        <section>
          <h3>What we learnt</h3>
          <br>
          <p class="slightly-smaller-text">
            Domain-Driven Design is hard to pronounce
          </p>
          <br>
          <p class="slightly-smaller-text">
            DDD for managing complex domains
          </p>
          <br>
          <p class="slightly-smaller-text">
            Ruby expressiveness helps
          </p>
        </section>
        <section>
          <h2>Final Thoughts</h2>
          <div style="font-size: 80%">
            <p class="slightly-smaller-text">
              Good models illuminate complex realities
            </p>
            <p class="slightly-smaller-text">
              Code can be both functional and educational
            </p>
            <p class="slightly-smaller-text">
              Ruby deserves a place in scientific computing
            </p>
          </div>
        </section>
        <section>
          <p>
            <img
              src="img/thoughtbot.svg"
              alt="thoughtbot LOGO"
              style="width: 300px; border: 0; box-shadow: none">
          </p>
        </section>
        <section data-background="img/suns.jpeg">
          <h2 style="margin-top: 450px; font-size: 2.5em">
            Thank you
          </h2>
        </section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
    <script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
        controls: false,
        transition: 'none',
        progress: true,
        // slideNumber: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealNotes,
        ]
			});
		</script>
	</body>
</html>
